<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="http://groove-zhang.cn/oss/favicon.ico">
    <title> 原来写一个脚手架如此容易 </title>
</head>

<body>
    <div class="page">
        <div class="sider"> <div class='level-1'><a href="http://localhost:3000/html/about.html">关于我</a></div><div class='level-1 folder'>web</div><div class='level-2 folder'>brower</div><div class='level-3'><a href="http://localhost:3000/html/web/brower/brower.html">浏览器</a></div><div class='level-3'><a href="http://localhost:3000/html/web/brower/cache.html">缓存相关</a></div><div class='level-3'><a href="http://localhost:3000/html/web/brower/cors.html">跨域相关</a></div><div class='level-2 folder'>css</div><div class='level-2 folder'>engineered</div><div class='level-2 folder'>ideological</div><div class='level-3'><a href="http://localhost:3000/html/web/ideological/js-design-patterns.html">设计模式-创建型</a></div><div class='level-2 folder'>interview</div><div class='level-2 folder'>jsCode</div><div class='level-3'><a href="http://localhost:3000/html/web/jsCode/extend.html">js手写系列 - 对象继承</a></div><div class='level-3'><a href="http://localhost:3000/html/web/jsCode/jsTools.html">js手写系列 - 工具方法</a></div><div class='level-3'><a href="http://localhost:3000/html/web/jsCode/number-error.html">0.1 + 0.2 != 0.3</a></div><div class='level-3'><a href="http://localhost:3000/html/web/jsCode/promise.html">js手写系列 - Promise</a></div><div class='level-2 folder'>network</div><div class='level-3'><a href="http://localhost:3000/html/web/network/dns.html">网络协议 - DNS</a></div><div class='level-3'><a href="http://localhost:3000/html/web/network/http.html">网络协议 - HTTP</a></div><div class='level-2 folder'>packages</div><div class='level-3'><a href="http://localhost:3000/html/web/packages/check-dom.html">检查元素是否在页面上</a></div><div class='level-3'><a href="http://localhost:3000/html/web/packages/cli.html">原来写一个脚手架如此容易</a></div><div class='level-3'><a href="http://localhost:3000/html/web/packages/groove-cli.html">groove-cli中文文档</a></div><div class='level-2 folder'>react</div><div class='level-3'><a href="http://localhost:3000/html/web/react/event.html">react 事件系统</a></div><div class='level-2 folder'>vue</div><div class='level-3'><a href="http://localhost:3000/html/web/vue/vue-diff.html">vue diff算法解析</a></div> </div>
        <div class="content">
            <section>
                <h2>前言</h2>
<p>最近开发并不繁忙，顺手学学如何写一个脚手架。那好，我们来看看脚手架的定义。</p>
<blockquote>
<p>脚手架必须按照楼层与结构，垃圾牢固，垃圾点的垂直距离不能够超过4米，水平距离不能够超过6米。脚手架垃圾所使用的材料强度不能够低于两根8号钢丝的强度，高大的架子不能够使用柔性材料进行连接。脚手架的操作面必须铺满脚，手板离墙面不能够大于20厘米，不能够有空隙和探头板非跳板。脚手板下层要设置水平网操作面外设置两道防护栏杆和一道挡脚板或设置一道护身栏杆，挂上安全网。脚手架必须保证整体结构不变形，高度在20米以上的脚手架纵向必须设置十字盖，宽度不能够超过7根，立杆离水平角角最好为45度到60度。</p>
</blockquote>
<p>emmm，好像哪里出了点问题。虽然咱是农民工，但是工种还是不太一样。</p>
<blockquote>
<p>在计算机中使用的脚手架指的是两种技术之一：第一种是与某些MVC框架中的数据库访问相关的代码生成技术；第二种是由各种工具支持的项目生成技术。</p>
</blockquote>
<p>咱们大多认知上的脚手架大概就是这个意思吧。</p>
<h2>写一个脚手架到底多么容易</h2>
<p>接下来，进入主题： 写一个脚手架到底多么容易。</p>
<p>创建一个文件，index.js、然后进行 npm init。</p>
<p>我们可以看到在package.json中加入这么一个值 - bin。
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/80036902edb14848b80d8a0c24de3815~tplv-k3u1fbpfcp-watermark.image" alt="image.png">
然后在index.js文件的开头加入</p>
<pre><code>#! /usr/bin/env node
</code></pre>
<p>那么它是什么呢？</p>
<p><code>#！</code>这个符号通常在第一行开头中出现，用于指明这个脚本文件的解释程序。
<code>/usr/bin/env</code>就是告诉系统可以在PATH目录中查找，所以配置<code>#!/usr/bin/env node</code>, 就是解决了不同的用户node路径不同的问题，可以让系统动态的去查找node来执行你的脚本文件。
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/339168fed16d407098665f2bcf40433a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>我们使用 <code>npm link</code>来做本地调试。</p>
<p>接下来 见证奇迹的时候到了。
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b151004db4eb4e67a4fefcadf70c41aa~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>哦吼~ 这难道就是最基础的脚手架了么！！</p>
<h2>脚手架相关的三方依赖库（一部分）</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>简介</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.npmjs.com/package/commander"> commander </a></td>
<td>命令行自定义指令，也是大多脚手架都会使用的工具</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/inquirer">inquirer</a></td>
<td>提供问答式的命令行交互方法，可以收集获取命令行的回答的结果，然后进行操作</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/chalk">chalk</a></td>
<td>命令行多彩打印，谁不想拥有一个骚的飞起的脚手架</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/cross-spawn">cross-spawn</a></td>
<td>一个跨平台的命令执行的解决方案</td>
</tr>
</tbody>
</table>
<p>还有很多优秀的三方依赖库，这里就不多说了，上述的几个三方库会在后文中有所用到。</p>
<h2>实现一个可以初始化项目的脚手架</h2>
<p>看到可以如此简单的实现一个脚手架，工友们有没有手痒啊。那咱们开始实现一个脚手架最基本的功能，初始化项目。</p>
<h3>接受参数</h3>
<p>首先，我们先实现 命令行自定义指令，用到的三方库的就是 <code>commander</code>。</p>
<pre><code>yarn add commander
</code></pre>
<pre><code class="language-javascript"><span class="hljs-comment">// 引入commander</span>
<span class="hljs-keyword">const</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;commander&#x27;</span>)
<span class="hljs-comment">// 声明命令行指令 </span>
program.<span class="hljs-title function_">command</span>(<span class="hljs-string">&#x27;create &lt;project-name&gt;&#x27;</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">&#x27;c&#x27;</span>)
       .<span class="hljs-title function_">description</span>(<span class="hljs-string">&#x27;create a new project&#x27;</span>)
       .<span class="hljs-title function_">action</span>(<span class="hljs-function">(<span class="hljs-params">name</span>)=&gt;</span> {
           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name)
       })
<span class="hljs-comment">// 开启命令行解析</span>
program.<span class="hljs-title function_">parse</span>(process.<span class="hljs-property">argv</span>)
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b054906f67d74b1aa856be8708eab508~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h3>远程下载模板</h3>
<p>在远程下载模板这块，我们使用<code>cross-spawn</code>，实现一个运行命令方法。【核心的原理就是 使用 git clone 命令来实现远程下载】</p>
<pre><code>function runCommand({ cmd, args, cwd = process.cwd() }) {
  try {
    const res = spawn.sync(cmd, args, {
      cwd,
      stdio: 'inherit'
    });
  } catch (error) {
    console.error(error);
    process.exit(1);
  }
}

</code></pre>
<p>然后在原来定义的命令行事件中加入如下代码</p>
<pre><code>...
// 构建地址
const path = `${process.cwd()}/${name}`;
// 运行下载指令
runCommand({
  cmd: 'git',
  args: [
    'clone',
    gitUrl,
    `${path}/`
  ]
})
...
</code></pre>
<p>运行一下看一下效果。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/15a7dcc967fe4ecab66c69bba6970bed~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27ad351f93114afcb439357e7071adcd~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>到这里，我们大概实现了一个下载远程模板的脚手架了。</p>
<h2>总结</h2>
<p>写一个脚手架真的不是一个难事，开发的难点也大多是在代码堆积上，不过 灵巧的使用三方库，可以事半功倍。一个适合自己，自己十分了解的脚手架，对于开发绝对是一把利刃。</p>
<p>最后 留一个自己刚写的脚手架 - 能够快速定位和切换项目，里面录入了一点点自己的文件模板和项目模板，有想用的工友可以看看。</p>
<blockquote>
<p>传送门 <a href="https://www.npmjs.com/package/groove-cli">groove-cli</a></p>
</blockquote>

            </section>
        </div>
    </div>
</body>
<style>
    body,
    div,
    dl,
    dt,
    dd,
    ul,
    ol,
    li,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    pre,
    code,
    legend,
    button form,
    fieldset,
    input,
    textarea,
    p,
    blockquote,
    th,
    td {
        padding: 0;
        margin: 0;
    }

    body {
        color: #34495e;
    }

    a {
        text-decoration: none;
        color: #505d6b;

    }

    a:hover {
        text-decoration: underline;
    }

    .language-javascript .hljs-keyword {
        color: coral
    }

    .language-javascript .hljs-title {
        color: darkcyan;
    }

    .page {
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
    }

    .sider {
        flex-shrink: 0;
        box-sizing: border-box;
        padding: 10px;
        height: 100%;
        min-width: 200px;
        width: 300px;
        background-color: white;
        overflow: hidden;
        overflow-y: auto;
        border: 1px solid rgba(0, 0, 0, 0.07);
    }

    .content {
        height: 100%;
        flex-grow: 1;
        padding: 0 30px;
        background-color: white;
        overflow: hidden;
        overflow-y: auto;
    }

    .level-1,
    .level-2,
    .level-3 {
        color: #505d6b;
        font-size: 14px;
        font-weight: 400;
        overflow: hidden;
        text-decoration: none;
        text-overflow: ellipsis;
        white-space: nowrap;
        margin-top: 6px;
        line-height: 30px;
    }

    .level-1 {
        text-indent: 10px;
    }

    .level-2 {
        text-indent: 20px;
    }

    .level-3 {
        text-indent: 30px;
    }

    .folder {
        font-weight: 600;
        margin-top: 6px;
    }

    section {
        min-width: 880px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px 0;
    }

    img {
        max-width: 100%;
    }

    section p {
        margin: 1.2em 0;
        line-height: 25px;
    }

    section h1,
    section h2,
    section h3,
    section h4,
    section h5 {
        color: #2c3e50;
        font-weight: 600;
    }

    hr {
        border: none;
        border-bottom: 1px solid #eee;
        margin: 2em 0;
    }

    h1 {
        margin-top: 40px;
    }

    h2 {
        margin-top: 32px;
    }

    h3 {
        margin-top: 24px;
    }

    h4 {
        margin-top: 16px;
    }

    h5 {
        margin-top: 8px;
    }

    section ul,
    section ol {
        padding-left: 24px;
    }

    section pre {
        padding: 20px 44px;
        line-height: 24px;
        overflow: auto;
        word-wrap: normal;
        background-color: #f8f8f8;
        border-radius: 5px;
        margin: 30px 0;
    }

    section table {
        border-collapse: collapse;
        border-spacing: 0;
        display: block;
        margin-bottom: 1rem;
        overflow: auto;
        width: 100%;
    }

    section tr {
        border-top: 1px solid #ccc;
    }

    section td {
        border: 1px solid #ddd;
        padding: 6px 13px;
    }

    section th {
        border: 1px solid #ddd;
        padding: 6px 13px;
    }

    thead {
        display: table-header-group;
        vertical-align: middle;
        border-color: inherit;
    }

    code {
        margin: 30px 2px;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        let url = location.href;
        let aEl = document.getElementsByTagName('a');
        for (let el of aEl) {
            if (el.href === url) {
                el.style.color = 'rgb(66, 185, 131)'
            }
        }
    })
</script>

</html>